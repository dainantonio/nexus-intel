<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NEXUS INTEL | AI × Data × Energy × Policy</title>
    
    <link rel="manifest" href="manifest.json">
    
    <link rel="preconnect" href="https://cdnjs.cloudflare.com">
    <link rel="preconnect" href="https://unpkg.com">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    <link href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" rel="stylesheet">
    
    <link rel="stylesheet" href="style.css">
    
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js" defer></script>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/apexcharts" defer></script>
</head>
<body>

    <div class="scanlines" style="display: none;"></div>
    <div class="crt-flicker" style="display: none;"></div>
    <div class="glow-overlay" style="display: none;"></div>

    <div id="cyberTooltip" class="cyber-tooltip"></div>

    <div id="notificationArea" class="notification">
        <i data-lucide="check-circle" style="color: var(--color-electric-green)"></i>
        <span id="notificationText">System Ready</span>
    </div>

    <div id="bulkActionBar" class="bulk-action-bar">
        <div class="bulk-counter">0 SELECTED</div>
        <button class="action-btn" onclick="bulkMarkRead()" title="Mark Read"><i data-lucide="check-square"></i></button>
        <button class="action-btn" onclick="bulkBookmark()" title="Bookmark"><i data-lucide="bookmark"></i></button>
        <button class="action-btn" onclick="toggleBulkMode()" title="Exit Bulk Mode" style="border-color:#ff4757; color:#ff4757;"><i data-lucide="x"></i></button>
    </div>

    <div class="modal-overlay" id="searchModal">
        <div class="modal-content">
            <div class="search-container">
                <div class="search-header">
                    <i data-lucide="search" style="color: var(--color-electric-green);"></i>
                    <input type="text" class="search-input" id="searchInput" placeholder="Search global intelligence..." aria-label="Search" autocomplete="off">
                    <button class="action-btn" id="closeSearchBtn" aria-label="Close Search"><i data-lucide="x"></i></button>
                </div>
                <div class="search-results" id="searchResults"></div>
                <div class="search-footer">
                    <span><i data-lucide="arrow-up" size="12"></i> <i data-lucide="arrow-down" size="12"></i> to navigate</span>
                    <span><i data-lucide="corner-down-left" size="12"></i> to select</span>
                    <span><span style="border: 1px solid #333; padding: 2px 6px; border-radius: 4px;">ESC</span> to close</span>
                </div>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="readerModal">
        <div class="modal-content">
            <div class="reader-container">
                <div style="display:flex; justify-content:flex-end; margin-bottom:10px;">
                    <button class="action-btn" onclick="document.getElementById('readerModal').classList.remove('active')" aria-label="Close Reader"><i data-lucide="x"></i></button>
                </div>
                <h1 id="readerTitle" class="reader-title">Article Title</h1>
                <div class="reader-meta">
                    <span id="readerSource">Source</span>
                    <span>•</span>
                    <span id="readerTime">Time</span>
                    <span id="readerTag" class="reader-badge">TAG</span>
                </div>
                <div id="readerBody" class="reader-content"></div>
                <div style="margin-top: 30px; border-top: 1px solid var(--color-border); padding-top: 20px;">
                    <h3 style="color: var(--color-electric-green); font-size: 0.9rem; margin-bottom: 10px;">INTELLIGENCE SUMMARY</h3>
                    <div id="readerAiSummary" style="font-size: 0.95rem; color: #aaa; background: rgba(0,255,157,0.05); padding: 15px; border-radius: 8px;"></div>
                </div>
                <div style="margin-top: 20px; display:flex; justify-content:center;">
                    <button class="ai-analysis-btn" id="readerExternalLink" style="width: auto; padding: 10px 25px;">OPEN ORIGINAL SOURCE <i data-lucide="external-link" size="14"></i></button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="infoModal">
        <div class="modal-content">
            <div class="info-container">
                <div class="info-header">
                    <div class="info-tabs">
                        <div class="info-tab active" data-tab="api">API DOCS</div>
                        <div class="info-tab" data-tab="logs">SYSTEM LOGS</div>
                        <div class="info-tab" data-tab="privacy">PRIVACY</div>
                        <div class="info-tab" data-tab="terms">TERMS</div>
                    </div>
                    <button class="action-btn" id="closeInfoBtn"><i data-lucide="x"></i></button>
                </div>
                <div class="info-body">
                    <div id="tab-api" class="info-section active">
                        <h3 style="margin-bottom:15px; color:white;">Nexus API v4.0.2</h3>
                        <p style="color:#aaa; font-size:0.9rem; margin-bottom:10px;">Access the global intelligence stream programmatically.</p>
                        <div style="background:rgba(0,0,0,0.3); padding:15px; border-radius:8px; font-family:'JetBrains Mono'; color:#00ff9d; font-size:0.8rem; margin-bottom:20px;">
                            GET https://api.nexus-intel.io/v1/stream/latest<br>
                            Authorization: Bearer YOUR_API_KEY
                        </div>
                        <p style="color:#aaa; font-size:0.9rem;">Rate limits: 500 req/min for Enterprise tier.</p>
                    </div>
                    <div id="tab-logs" class="info-section">
                        <h3 style="margin-bottom:15px; color:white;">System Event Stream</h3>
                        <div id="systemLogContainer" style="height:300px; overflow-y:auto; background:rgba(0,0,0,0.3); padding:15px; border-radius:8px;"></div>
                    </div>
                    <div id="tab-privacy" class="info-section">
                        <h3 style="margin-bottom:15px; color:white;">Data Privacy Protocol</h3>
                        <p style="color:#aaa; line-height:1.6; font-size:0.9rem;">Nexus Intel operates on a zero-retention policy for user search queries. All geospatial data is anonymized before aggregation. We adhere to GDPR and CCPA compliance standards for all data vectors.</p>
                    </div>
                    <div id="tab-terms" class="info-section">
                        <h3 style="margin-bottom:15px; color:white;">Terms of Service</h3>
                        <p style="color:#aaa; line-height:1.6; font-size:0.9rem;">By accessing the NEXUS mainframe, you agree to utilize the intelligence provided for lawful predictive analysis only. Market manipulation based on simulated signals is strictly prohibited.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="helpModal">
        <div class="modal-content">
            <div class="settings-container">
                <div style="display: flex; justify-content: space-between; margin-bottom: 25px;">
                    <h2><i data-lucide="keyboard" style="color: var(--color-electric-green); margin-right: 10px;"></i> Shortcuts</h2>
                    <button class="action-btn" onclick="document.getElementById('helpModal').classList.remove('active')" aria-label="Close Help"><i data-lucide="x"></i></button>
                </div>
                <div class="help-grid">
                    <div class="help-item"><span>Search Modal</span> <span class="help-key">Cmd + K</span></div>
                    <div class="help-item"><span>Focus Search</span> <span class="help-key">/</span></div>
                    <div class="help-item"><span>Toggle View</span> <span class="help-key">V</span></div>
                    <div class="help-item"><span>Refresh Data</span> <span class="help-key">R</span></div>
                    <div class="help-item"><span>Toggle Settings</span> <span class="help-key">S</span></div>
                    <div class="help-item"><span>Bulk Mode</span> <span class="help-key">B</span></div>
                    <div class="help-item"><span>Mark Read</span> <span class="help-key">M</span></div>
                    <div class="help-item"><span>Mark All Read</span> <span class="help-key">Shift + M</span></div>
                    <div class="help-item"><span>Close Modals</span> <span class="help-key">Esc</span></div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="settingsModal">
        <div class="modal-content">
            <div class="settings-container">
                <div style="display: flex; justify-content: space-between; margin-bottom: 25px;">
                    <h2><i data-lucide="settings" style="color: var(--color-electric-green); margin-right: 10px;"></i> System Config</h2>
                    <button class="action-btn" id="closeSettingsBtn" aria-label="Close Settings"><i data-lucide="x"></i></button>
                </div>
                <div class="setting-group">
                    <h3><i data-lucide="eye"></i> Interface</h3>
                    <div class="setting-item">
                        <div>
                            <div style="font-weight: 500;">Cyberpunk Mode</div>
                            <div style="font-size: 0.8rem; color: var(--color-text-muted);">Scanlines & CRT effects</div>
                        </div>
                        <label class="switch"><input type="checkbox" id="cyberpunkToggle"><span class="slider"></span></label>
                    </div>
                    <div class="setting-item">
                        <div>
                            <div style="font-weight: 500;">Default View Mode</div>
                            <div style="font-size: 0.8rem; color: var(--color-text-muted);">Preferred dashboard layout</div>
                        </div>
                         <select id="defaultViewSelect" style="background: rgba(0,0,0,0.3); border: 1px solid var(--color-border); padding: 5px 10px; color: white; border-radius: 4px;">
                            <option value="row">Row View</option>
                            <option value="grid">Grid View</option>
                        </select>
                    </div>
                    <div class="setting-item">
                        <div>
                            <div style="font-weight: 500;">Auto-Mark Read</div>
                            <div style="font-size: 0.8rem; color: var(--color-text-muted);">Mark read when opening</div>
                        </div>
                        <label class="switch"><input type="checkbox" id="autoMarkReadToggle" checked><span class="slider"></span></label>
                    </div>
                    <div class="setting-item">
                        <div>
                            <div style="font-weight: 500;">Accent Color</div>
                            <div style="font-size: 0.8rem; color: var(--color-text-muted);">Primary theme color</div>
                        </div>
                        <input type="color" id="accentColorPicker" class="color-picker-input" value="#00ff9d">
                    </div>
                </div>
                <div class="setting-group">
                    <h3><i data-lucide="filter"></i> Intelligence Filters</h3>
                    <div class="setting-item" style="display:block;">
                         <div style="font-weight: 500;">Highlight Keywords</div>
                         <div style="font-size: 0.8rem; color: var(--color-text-muted);">Visually tag signals (comma separated)</div>
                         <div class="keyword-input-container">
                             <input type="text" id="newHighlightInput" class="setting-input" placeholder="e.g. nvidia, fusion" style="margin-top:0;">
                             <button id="addHighlightBtn" class="action-btn" style="width: 40px; height: 38px; border-radius: 6px;"><i data-lucide="plus"></i></button>
                         </div>
                         <div id="highlightKeywordsList" class="keyword-tags"></div>
                    </div>
                    <div class="setting-item" style="display:block;">
                         <div style="font-weight: 500;">Muted Keywords</div>
                         <div style="font-size: 0.8rem; color: var(--color-text-muted);">Hide signals containing these words</div>
                         <div class="keyword-input-container">
                             <input type="text" id="newKeywordInput" class="setting-input" placeholder="e.g. crypto, gossip" style="margin-top:0;">
                             <button id="addKeywordBtn" class="action-btn" style="width: 40px; height: 38px; border-radius: 6px;"><i data-lucide="plus"></i></button>
                         </div>
                         <div id="mutedKeywordsList" class="keyword-tags"></div>
                    </div>
                </div>
                <div class="setting-group">
                    <h3><i data-lucide="bell"></i> Data Stream</h3>
                    <div class="setting-item">
                        <div>
                            <div style="font-weight: 500;">Breaking News Alerts</div>
                            <div style="font-size: 0.8rem; color: var(--color-text-muted);">Top banner for high impact events</div>
                        </div>
                        <label class="switch"><input type="checkbox" id="breakingNewsToggle" checked><span class="slider"></span></label>
                    </div>
                    <div class="setting-item">
                         <button id="forceBreakingBtn" style="width:100%; padding:10px; background:rgba(255, 71, 87, 0.1); color:#ff4757; border:1px solid #ff4757; border-radius:8px; cursor:pointer; font-weight:700; font-size:0.8rem;">
                            <i data-lucide="alert-triangle" size="14" style="margin-right:5px;"></i> SIMULATE BREAKING EVENT
                        </button>
                    </div>
                    <div class="setting-item">
                        <div>
                            <div style="font-weight: 500;">Live Simulation</div>
                            <div style="font-size: 0.8rem; color: var(--color-text-muted);">Inject mock events every 45s</div>
                        </div>
                        <label class="switch"><input type="checkbox" id="liveSimToggle"><span class="slider"></span></label>
                    </div>
                </div>
                <div class="setting-group">
                    <h3><i data-lucide="key"></i> API Configuration</h3>
                    <input type="password" id="geminiKey" class="setting-input" placeholder="Gemini API Key">
